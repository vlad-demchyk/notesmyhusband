# Огляд архітектури Apollo Client та розподілу відповідальностей

## ✅ Виправлення виконано

### Було:

1. **Дублювання обробки помилок** - і в `useAuthActions`, і в `useAuthStore`
2. **Змішування відповідальностей** - `useAuthActions` робив і запити, і обробку помилок, і зберігання токена
3. **Складні перевірки помилок** - однакові перевірки в обох файлах

### Стало:

1. **Чіткий розподіл відповідальностей**
2. **useAuthActions** - тільки API виклики, мінімальна обробка помилок
3. **useAuthStore** - управління станом, обробка помилок для UI, зберігання токенів

## Правильний розподіл відповідальностей

### useAuthActions.ts (API Layer)
**Відповідальність:** Тільки виклики GraphQL API
- Формування GraphQL запитів
- Виклик Apollo Client
- Базова обробка помилок (тільки для логування)
- Повернення даних або викидання помилок

**НЕ повинен:**
- Управляти станом (user, token)
- Обробляти помилки для UI
- Зберігати токени (це має робити store)

### useAuthStore.ts (State Management Layer)
**Відповідальність:** Управління станом та координація
- Зберігання стану (user, token, isLoading)
- Виклик actions
- Обробка помилок для UI (форматування повідомлень)
- Оновлення стану на основі результатів
- Зберігання токенів в localStorage

## Рекомендована структура

```
useAuthActions (API Layer)
  ├─ login() → повертає { user, token } або throw Error
  ├─ registerUser() → повертає { user, token } або throw Error
  ├─ getCurrentUser() → повертає user або null
  └─ logout() → void

useAuthStore (State Layer)
  ├─ Викликає useAuthActions
  ├─ Оновлює state (user, token, isLoading)
  ├─ Обробляє помилки для UI
  ├─ Зберігає токени в localStorage
  └─ Повертає { success, error } для компонентів
```
